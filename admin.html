<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Emploi du Temps</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles sp√©cifiques √† la page Admin */
        
        /* NOUVEAU : Une barre d'ent√™te pour le bouton d√©connexion */
        .top-bar {
            display: flex;
            justify-content: flex-end; /* Pousse le contenu √† droite */
            padding: 10px 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        .admin-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none; /* Cach√© par d√©faut */
        }

        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        /* Style pour ton message de bienvenue */
        h1.welcome-title {
            color: #2c3e50;
            text-align: center;
            font-size: 32px;
            margin-bottom: 10px;
            margin-top: 0; /* On enl√®ve la marge du haut pour le rapprocher */
            padding: 10px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            letter-spacing: 1px;
            line-height: 1.2;
        }
        
        form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        #loginForm {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        
        .form-group.full-width {
            grid-column: span 2;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button.btn-submit {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            grid-column: span 2;
            margin-top: 20px;
        }
        
        button.btn-submit:hover {
            background-color: #219150;
        }

        .btn-login {
            background-color: #3498db;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Bouton d√©connexion restylis√© */
        .btn-logout {
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px; /* Plus arrondi */
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: background 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn-logout:hover {
            background-color: #c0392b;
        }

        /* Style pour le bouton d'importation */
        .import-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f6f3;
            border: 2px dashed #27ae60;
            border-radius: 8px;
            text-align: center;
        }
        
        .btn-import {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn-import:hover {
            background-color: #2980b9;
        }

        .course-list {
            margin-top: 40px;
        }

        .course-item {
            background: #f9f9f9;
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        /* Responsive pour mobile : empiler le formulaire */
        @media (max-width: 600px) {
            form {
                grid-template-columns: 1fr;
            }
            .form-group.full-width {
                grid-column: span 1;
            }
            h1.welcome-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>

    <!-- SECTION DE CONNEXION -->
    <div id="loginSection" class="login-container">
        <h2>üîí Connexion Admin</h2>
        <form id="loginForm">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" placeholder="votre@email.com" required>
            </div>
            <div class="form-group">
                <label>Mot de passe</label>
                <input type="password" id="password" placeholder="********" required>
            </div>
            <button type="submit" class="btn-login">Se connecter</button>
        </form>
        <div style="margin-top: 20px;">
            <a href="index.html">‚Üê Retour √† l'accueil</a>
        </div>
    </div>

    <!-- SECTION ADMIN (Cach√©e par d√©faut) -->
    <div id="adminSection" style="display: none;">
        
        <!-- Barre sup√©rieure d√©di√©e au bouton d√©connexion -->
        <div class="top-bar">
            <button id="btnLogout" class="btn-logout">Se d√©connecter</button>
        </div>

        <!-- Titre bien centr√© et d√©gag√© -->
        <h1 class="welcome-title">Bonjour Mr.SIBY bienvenue sur votre espace administrateur ‚öô</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <a href="index.html" style="font-size: 16px; text-decoration: none; color: #7f8c8d; border-bottom: 1px solid #bdc3c7;">‚Üê Retour √† l'Emploi du Temps public</a>
        </div>

        <div class="admin-container" style="display: block;">
            <h2 style="text-align:center; margin-bottom:20px; color:#34495e;">Ajouter un Cours</h2>
            <form id="addCourseForm">
                
                <div class="form-group">
                    <label>Groupe</label>
                    <select id="groupe" required>
                        <option value="Groupe 1">Groupe 1</option>
                        <option value="Groupe 2">Groupe 2</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Jour</label>
                    <select id="jour" required>
                        <option value="Lundi">Lundi</option>
                        <option value="Mardi">Mardi</option>
                        <option value="Mercredi">Mercredi</option>
                        <option value="Jeudi">Jeudi</option>
                        <option value="Vendredi">Vendredi</option>
                        <option value="Samedi">Samedi</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Horaire</label>
                    <select id="heure" required>
                        <option value="08H-11H">08H-11H</option>
                        <option value="11H-14H">11H-14H</option>
                        <option value="14H-17H">14H-17H</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Code Mati√®re</label>
                    <input type="text" id="code" placeholder="Ex: STIT342(I)" required>
                </div>

                <div class="form-group full-width">
                    <label>Nom Complet de la Mati√®re</label>
                    <input type="text" id="matiere" placeholder="Ex: Mod√©lisation des syst√®mes..." required>
                </div>

                <div class="form-group">
                    <label>Salle</label>
                    <input type="text" id="salle" placeholder="Ex: B13" required>
                </div>

                <div class="form-group">
                    <label>Enseignant</label>
                    <input type="text" id="enseignant" placeholder="Ex: M. NINDJIN" required>
                </div>

                <div class="form-group">
                    <label>Couleur (Classe CSS)</label>
                    <select id="classeCouleur">
                        <option value="stit341">Bleu Clair (stit341)</option>
                        <option value="stit342">Jaune (stit342)</option>
                        <option value="stit311">Violet (stit311)</option>
                        <option value="stit312">Vert (stit312)</option>
                        <option value="stcu361">Vert Lime (stcu361)</option>
                        <option value="stla351">Indigo (stla351)</option>
                        <option value="stpr371">Gris (stpr371)</option>
                    </select>
                </div>

                <button type="submit" class="btn-submit">Ajouter le Cours</button>
            </form>

            <div class="import-section">
                <h3>üöÄ Importation Rapide</h3>
                <p>Clique ici pour ajouter automatiquement tous les cours du semestre.</p>
                <button id="btnImport" class="btn-import">Importer les cours par d√©faut</button>
            </div>

            <div class="course-list">
                <h2>Liste des Cours Actuels</h2>
                <div id="coursesContainer">
                    <p>Chargement...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDc45__U4Swdnf-k4iqr9ZdPZUFhkL5NPE",
            authDomain: "edt-iter-l2.firebaseapp.com",
            projectId: "edt-iter-l2",
            storageBucket: "edt-iter-l2.firebasestorage.app",
            messagingSenderId: "846836827338",
            appId: "1:846836827338:web:c7ae5d6fca94a4f5e12033"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 

        const loginSection = document.getElementById('loginSection');
        const adminSection = document.getElementById('adminSection');
        const loginForm = document.getElementById('loginForm');
        const btnLogout = document.getElementById('btnLogout');
        
        const form = document.getElementById('addCourseForm');
        const coursesContainer = document.getElementById('coursesContainer');
        const btnImport = document.getElementById('btnImport');

        // --- AUTH ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                loadCourses();
            } else {
                loginSection.style.display = 'block';
                adminSection.style.display = 'none';
                coursesContainer.innerHTML = "<p>Connectez-vous pour g√©rer les cours.</p>";
            }
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, email, password)
                .catch((error) => { alert("Erreur de connexion : " + error.message); });
        });

        btnLogout.addEventListener('click', () => {
            signOut(auth).then(() => { alert("D√©connect√© !"); }).catch(console.error);
        });

        // --- COURS PAR DEFAUT ---
        const defaultCourses = [
            { groupe: "Groupe 1", jour: "Lundi", heure: "08H-11H", code: "STIT342(I)", matiere: "Mod√©lisation des syst√®mes (UML)", salle: "B13", enseignant: "M. NINDJIN", classeCouleur: "stit342" },
            { groupe: "Groupe 1", jour: "Lundi", heure: "11H-14H", code: "STIT332", matiere: "Intro prog web", salle: "B13", enseignant: "M. NINDJIN", classeCouleur: "stit332" },
            { groupe: "Groupe 1", jour: "Lundi", heure: "14H-17H", code: "STLA351", matiere: "Anglais sc. et tech.", salle: "B14", enseignant: "M. BALLIET", classeCouleur: "stla351" },
            { groupe: "Groupe 1", jour: "Mardi", heure: "08H-11H", code: "STIT342(EEA)", matiere: "Automatisme (GRAFCET)", salle: "B12", enseignant: "M. ACHY", classeCouleur: "stit342" },
            { groupe: "Groupe 1", jour: "Mardi", heure: "14H-17H", code: "STIT312", matiere: "Initiation langage machine", salle: "B16", enseignant: "M. ACHY", classeCouleur: "stit312" },
            { groupe: "Groupe 1", jour: "Mercredi", heure: "08H-11H", code: "STIT311", matiere: "Th√©orie des langages", salle: "B7", enseignant: "M. N'GUESSAN", classeCouleur: "stit311" },
            { groupe: "Groupe 1", jour: "Mercredi", heure: "11H-14H", code: "STIT322", matiere: "Concepts r√©seaux", salle: "B13", enseignant: "M. N'GBESSO", classeCouleur: "stit322" },
            { groupe: "Groupe 1", jour: "Mercredi", heure: "14H-17H", code: "STIT321", matiere: "Electronique comm.", salle: "B14", enseignant: "M. YOBOQUET", classeCouleur: "stit321" },
            { groupe: "Groupe 1", jour: "Jeudi", heure: "14H-17H", code: "STIT342(IMT)", matiere: "Electronique num.", salle: "B13", enseignant: "M. NIAVA", classeCouleur: "stit342" },
            { groupe: "Groupe 1", jour: "Vendredi", heure: "08H-11H", code: "STCU361", matiere: "S'exprimer pour communiquer", salle: "B18", enseignant: "M. AFFI", classeCouleur: "stcu361" },
            { groupe: "Groupe 1", jour: "Vendredi", heure: "14H-17H", code: "STIT313", matiere: "Syst√®me d'exploitation", salle: "B13", enseignant: "M. AKOSSO", classeCouleur: "stit313" },
            { groupe: "Groupe 1", jour: "Samedi", heure: "08H-11H", code: "STIT331", matiere: "Prog imp√©rative", salle: "B13", enseignant: "M. CAMARA", classeCouleur: "stit331" },
            { groupe: "Groupe 1", jour: "Samedi", heure: "11H-14H", code: "STIT341(I)", matiere: "Analyse gestion (MERISE)", salle: "09", enseignant: "M. ANGAMAN", classeCouleur: "stit341" },
            { groupe: "Groupe 1", jour: "Samedi", heure: "14H-17H", code: "STIT341(I)", matiere: "Analyse gestion (MERISE)", salle: "09", enseignant: "M. ANGAMAN", classeCouleur: "stit341" },

            { groupe: "Groupe 2", jour: "Lundi", heure: "08H-11H", code: "STIT342(I)", matiere: "Mod√©lisation des syst√®mes (UML)", salle: "B13", enseignant: "M. NINDJIN", classeCouleur: "stit342" },
            { groupe: "Groupe 2", jour: "Lundi", heure: "14H-17H", code: "STLA351", matiere: "Anglais sc. et tech.", salle: "B2", enseignant: "M. KONE AMIDOU", classeCouleur: "stla351" },
            { groupe: "Groupe 2", jour: "Mardi", heure: "08H-11H", code: "STIT342(EEA)", matiere: "Automatisme (GRAFCET)", salle: "B12", enseignant: "M. ACHY", classeCouleur: "stit342" },
            { groupe: "Groupe 2", jour: "Mardi", heure: "11H-14H", code: "STIT312", matiere: "Initiation langage machine", salle: "B10", enseignant: "M. ACHY", classeCouleur: "stit312" },
            { groupe: "Groupe 2", jour: "Mardi", heure: "14H-17H", code: "STIT321", matiere: "Electronique comm.", salle: "B10", enseignant: "M. YOBOQUET", classeCouleur: "stit321" },
            { groupe: "Groupe 2", jour: "Mercredi", heure: "08H-11H", code: "STIT322", matiere: "Concepts r√©seaux", salle: "B10", enseignant: "M. N'GBESSO", classeCouleur: "stit322" },
            { groupe: "Groupe 2", jour: "Mercredi", heure: "14H-17H", code: "STCU361", matiere: "S'exprimer pour communiquer", salle: "B13", enseignant: "M. AFFI", classeCouleur: "stcu361" },
            { groupe: "Groupe 2", jour: "Jeudi", heure: "08H-11H", code: "STIT311", matiere: "Th√©orie des langages", salle: "B20", enseignant: "M. N'GUESSAN", classeCouleur: "stit311" },
            { groupe: "Groupe 2", jour: "Jeudi", heure: "11H-14H", code: "STIT332", matiere: "Intro prog web", salle: "B13", enseignant: "M. NINDJIN", classeCouleur: "stit332" },
            { groupe: "Groupe 2", jour: "Jeudi", heure: "14H-17H", code: "STIT341(EEA)", matiere: "Electronique puissance", salle: "B12", enseignant: "M. NEMLIN", classeCouleur: "stit341" },
            { groupe: "Groupe 2", jour: "Vendredi", heure: "08H-11H", code: "STIT331", matiere: "Prog imp√©rative", salle: "B13", enseignant: "M. GONO", classeCouleur: "stit331" },
            { groupe: "Groupe 2", jour: "Vendredi", heure: "11H-14H", code: "STIT313", matiere: "Syst√®me d'exploitation", salle: "B13", enseignant: "M. GONO", classeCouleur: "stit313" },
            { groupe: "Groupe 2", jour: "Samedi", heure: "11H-14H", code: "STIT341(IMT)", matiere: "Traitement signal", salle: "B16", enseignant: "M. N'GUESSAN", classeCouleur: "stit341" }
        ];

        // --- LOGIQUE ---
        btnImport.addEventListener('click', async () => {
            if(confirm(`Voulez-vous vraiment importer ${defaultCourses.length} cours ?`)) {
                btnImport.disabled = true;
                btnImport.innerText = "Importation en cours...";
                let count = 0;
                for (const course of defaultCourses) {
                    try { await addDoc(collection(db, "cours"), course); count++; } 
                    catch (e) { console.error(e); }
                }
                alert(`${count} cours import√©s !`);
                btnImport.innerText = "Importation Termin√©e";
                loadCourses(); 
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newCourse = {
                groupe: document.getElementById('groupe').value,
                jour: document.getElementById('jour').value,
                heure: document.getElementById('heure').value,
                code: document.getElementById('code').value,
                matiere: document.getElementById('matiere').value,
                salle: document.getElementById('salle').value,
                enseignant: document.getElementById('enseignant').value,
                classeCouleur: document.getElementById('classeCouleur').value
            };
            try {
                await addDoc(collection(db, "cours"), newCourse);
                alert("Cours ajout√© !");
                form.reset();
                loadCourses();
            } catch (error) { alert("Erreur : " + error.message); }
        });

        async function loadCourses() {
            coursesContainer.innerHTML = "Chargement...";
            const querySnapshot = await getDocs(collection(db, "cours"));
            coursesContainer.innerHTML = "";
            if (querySnapshot.empty) { coursesContainer.innerHTML = "<p>Aucun cours trouv√©.</p>"; return; }

            querySnapshot.forEach((docSnap) => {
                const course = docSnap.data();
                const id = docSnap.id;
                const div = document.createElement('div');
                div.className = 'course-item';
                div.innerHTML = `
                    <div>
                        <strong>${course.groupe}</strong> - ${course.jour} ${course.heure}<br>
                        ${course.code} - ${course.enseignant}
                    </div>
                    <button class="btn-delete" onclick="deleteCourse('${id}')">Supprimer</button>
                `;
                coursesContainer.appendChild(div);
            });
        }

        window.deleteCourse = async (id) => {
            if(confirm("Supprimer ?")) {
                await deleteDoc(doc(db, "cours", id));
                loadCourses();
            }
        }
    </script>

</body>
</html>